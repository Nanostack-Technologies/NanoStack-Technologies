{% extends 'custom_admin/base_admin.html' %}

{% block header %}Client Detail: {{ client.name }}{% endblock %}

{% block content %}
<div class="row">
    <!-- Client Info -->
    <div class="col-md-4">
        <div class="card p-3 mb-4">
            <h5 class="card-title">Attributes</h5>
            <hr>
            <p><strong>Email:</strong> {{ client.email }}</p>
            <p><strong>Phone:</strong> {{ client.phone }}</p>
            <p><strong>Company:</strong> {{ client.company }}</p>
            <p><strong>Address:</strong> {{ client.address|linebreaksbr }}</p>
            <p><strong>Notes:</strong> {{ client.notes|linebreaksbr }}</p>
            <div class="mt-3">
                <a href="{% url 'admin_client_edit' client.pk %}" class="btn btn-warning text-white">Edit</a>
                <a href="{% url 'admin_client_delete' client.pk %}" class="btn btn-danger">Delete</a>
            </div>
        </div>

        <div class="card p-3 mb-4">
            <h5 class="card-title">Financial Summary</h5>
            <hr>
            <div class="d-flex justify-content-between mb-2">
                <span>Total Billed:</span>
                <span class="fw-bold">₹{{ total_bill|floatformat:0 }}</span>
            </div>
            <div class="d-flex justify-content-between mb-2">
                <span>Amount Paid:</span>
                <span class="text-success fw-bold">₹{{ total_paid|floatformat:0 }}</span>
            </div>
            <div class="d-flex justify-content-between mb-2">
                <span>Total Expenses:</span>
                <span class="text-danger fw-bold">₹{{ total_expenses|floatformat:0 }}</span>
            </div>
            <hr>
            <div class="d-flex justify-content-between">
                <span>Total Profit:</span>
                <span class="{% if total_profit >= 0 %}text-success{% else %}text-danger{% endif %} fw-bold">₹{{ total_profit|floatformat:0 }}</span>
            </div>
        </div>
    </div>

    <!-- Projects List -->
    <div class="col-md-8">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <span>Projects</span>
                <a href="{% url 'admin_client_project_add' %}?client={{ client.pk }}" class="btn btn-primary btn-sm"><i class="fas fa-plus"></i> Add Project</a>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead>
                            <tr>
                                <th>Project Name</th>
                                <th>Status</th>
                                <th>Bill</th>
                                <th>Paid</th>
                                <th>Profit</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for project in projects %}
                            <tr>
                                <td>
                                    <a href="{% url 'admin_client_project_detail' project.pk %}" class="fw-bold text-decoration-none">{{ project.project_name }}</a>
                                    <div class="small text-muted">{{ project.created_at|date:"M d, Y" }}</div>
                                </td>
                                <td>
                                    {% if project.status == 'Completed' %}
                                        <span class="badge bg-success">Completed</span>
                                    {% elif project.status == 'In Progress' %}
                                        <span class="badge bg-primary">In Progress</span>
                                    {% elif project.status == 'On Hold' %}
                                        <span class="badge bg-warning text-dark">On Hold</span>
                                    {% else %}
                                        <span class="badge bg-secondary">{{ project.status }}</span>
                                    {% endif %}
                                </td>
                                <td>₹{{ project.total_bill|floatformat:0 }}</td>
                                <td class="text-success">₹{{ project.amount_paid|floatformat:0 }}</td>
                                <td class="{% if project.profit_or_loss >= 0 %}text-success{% else %}text-danger{% endif %}">
                                    ₹{{ project.profit_or_loss|floatformat:0 }}
                                </td>
                                <td>
                                    <a href="{% url 'admin_client_project_edit' project.pk %}" class="btn btn-sm btn-warning text-white"><i class="fas fa-edit"></i></a>
                                </td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="6" class="text-center py-4">No projects for this client yet.</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
