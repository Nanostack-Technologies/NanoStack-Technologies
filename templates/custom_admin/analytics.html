{% extends 'custom_admin/base_admin.html' %}

{% block header %}Project Analytics{% endblock %}

{% block content %}
<div class="row">
    <!-- Financial Overview Chart -->
    <div class="col-md-12 mb-4">
        <div class="card p-3">
            <h5 class="card-title">Monthly Financials</h5>
            <canvas id="financialChart" height="100"></canvas>
        </div>
    </div>
</div>

<div class="row">
    <!-- Status Distribution -->
    <div class="col-md-6 mb-4">
        <div class="card p-3 h-100">
            <h5 class="card-title">Project Status Distribution</h5>
            <canvas id="statusChart"></canvas>
        </div>
    </div>
    <!-- Payment Methods -->
    <div class="col-md-6 mb-4">
        <div class="card p-3 h-100">
            <h5 class="card-title">Payment Methods</h5>
            <canvas id="paymentChart"></canvas>
        </div>
    </div>
</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        fetch("{% url 'admin_analytics_data' %}")
            .then(response => response.json())
            .then(data => {
                // Financial Chart
                const ctxFinancial = document.getElementById('financialChart').getContext('2d');
                new Chart(ctxFinancial, {
                    type: 'bar',
                    data: {
                        labels: data.months,
                        datasets: [
                            {
                                label: 'Revenue',
                                data: data.revenue,
                                backgroundColor: '#3b82f6',
                            },
                            {
                                label: 'Expenses',
                                data: data.expenses,
                                backgroundColor: '#ef4444',
                            },
                            {
                                label: 'Profit',
                                data: data.profit,
                                backgroundColor: '#10b981',
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });

                // Status Chart
                const ctxStatus = document.getElementById('statusChart').getContext('2d');
                new Chart(ctxStatus, {
                    type: 'doughnut',
                    data: {
                        labels: data.status_labels,
                        datasets: [{
                            data: data.status_counts,
                            backgroundColor: [
                                '#3b82f6', '#10b981', '#f59e0b', '#6b7280', '#ef4444'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                    }
                });

                // Payment Chart
                const ctxPayment = document.getElementById('paymentChart').getContext('2d');
                new Chart(ctxPayment, {
                    type: 'pie',
                    data: {
                        labels: data.payment_labels,
                        datasets: [{
                            data: data.payment_counts,
                            backgroundColor: [
                                '#8b5cf6', '#ec4899', '#f97316', '#14b8a6', '#6366f1'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                    }
                });
            });
    });
</script>
{% endblock %}
